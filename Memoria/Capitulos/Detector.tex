%---------------------------------------------------------------------
%
%                          Capítulo 4
%
%---------------------------------------------------------------------
% !TEX root = ../Tesis.tex

\chapter{Detector}
\label{cap4}

\begin{resumen}
La detección es el paso que sigue al recoloreado y está dividida en dos partes.
La primera parte de la detección se basa en el análisis  de la imagen obtenida
en el recoloreado. Este análisis se lleva a cabo separando la imagen en dos que
representan los cambios a lo largo del tiempo y calculando las diferencias entre
cada posible pareja de estrellas. Con los resultados de este análisis se procede
a la fase de decisión la cual se encarga de procesar los resultados de la etapa
posterior y decidir, para cada pareja de estrellas, si forman o no una estrella
doble.
\end{resumen}

%-------------------------------------------------------------------
\section{Análisis}
%-------------------------------------------------------------------
\label{cap4:sec:analisis}

Hemos programado esta fase en el lenguaje Python, debido a la gran cantidad de
bibliotecas que permiten tratar imágenes.

\medskip

En particular, para la detección de estrellas dobles se decidió utilizar la
biblioteca de tratamiento de imágenes OpenCV. El desarrollo de esta fase se
realizó en varias etapas.

\medskip

Después de analizar cientos de imágenes de estrellas dobles, se decidió recrear
el mismo procedimiento que se realiza mentalmente a la hora de decidir si son
dobles o no. Para decidirlo hay que fijarse en que sus trayectorias sean
paralelas y la distancia recorrida sea aproximadamente la misma.

\medskip

Para llevar a cabo este procedimiento necesitamos encontrar un centro aproximado
de cada una de las estrellas del recoloreado para poder así buscar relaciones,
de distancia y ángulo, entre parejas de estrellas cuyo movimiento haya sido
similar a lo largo de los años.

\medskip

Una primera aproximación se basó en la búsqueda de los contornos de las diversas
estrellas en función de sus colores y el uso de estos contornos para obtener el
centro de la estrella. Esta aproximación permitió relacionar aquellas estrellas
cuyo movimiento hubiese sido lo suficientemente rápido como para que no
compartan ningún punto entre la primera foto y la segunda.

\figura{Vectorial/Detector/1}{width=.5\textwidth}{cap4:fig:1}%
{Estrella binaria con movimiento veloz}

\medskip

El movimiento de la estrella de la figura \ref{cap4:fig:1} es suficientemente
rápido como para que entre la primera foto y la segunda no exista ningún punto
en común por lo que la obtención del centro para su posterior análisis no
requiere de ningún cambio en la foto. El problema de este método radica en que
si la estrella no se ha movido lo suficientemente rápido, existirán puntos
comunes, representados en color blanco. Debido a esto, se obtendrían tres
centros distintos para una misma pareja de  estrellas y ninguno de ellos serían
los centros reales de las dos estrellas.

\medskip

El problema de este método radica en que si la estrella no se ha movido lo
suficientemente rápido. Se obtendrían tres centros distintos para una misma
pareja de estrellas y ninguno de ellos serían los centros reales de las dos
estrellas.

\figura{Vectorial/Detector/2}{width=.5\textwidth}{cap4:fig:2}%
{Estrella binaria cuyo movimiento no es tan apreciable debido a su menor velocidad}

\medskip

Para subsanar el error se decidió realizar el análisis de contornos por
separado. Para ello se filtran la imagen en dos imágenes de manera que una tiene
el color rojo y el blanco, y la otra el azul y el blanco. De esta manera se
obtienen los centros y áreas de las estrellas en origen y los centros de las
estrellas en el destino y se pueden relacionar de manera directa.

\figura{Vectorial/Detector/3}{width=.5\textwidth}{cap4:fig:3}%
{Estrella binaria con bajo movimiento propio}

\begin{figure}[t]
  \centering
  %
  \subfloat[][]{
    \includegraphics[width=0.42\textwidth]%
    {Imagenes/Vectorial/Detector/4}
    \label{cap4:fig:red}
  }
  \qquad
  \subfloat[][]{
    \includegraphics[width=0.42\textwidth]%
    {Imagenes/Vectorial/Detector/5}
    \label{cap4:fig:blue}
  }
  \caption{A partir de la imagen recoloreada, figura \ref{cap4:fig:3}, se obtienen dos imágenes}
\end{figure}

\medskip

Una vez obtenidos los centros y áreas de todas las estrellas se procede a
especificar cuál sería la estrella primaria, la de mayor área, y cuál sería la
estrella secundaria, de menor área. Y calculamos los valores necesarios para su
clasificación, figura \ref{cap4:fig:6}.

\figura{Vectorial/Detector/6}{width=.5\textwidth}{cap4:fig:6}%
{Representación de valores calculados}

\medskip

Los valores representados en la figura \ref{cap4:fig:6} corresponden a:

\begin{enumerate}[label=(\alph*)]
  \item Separación entre las estrellas en la segunda foto tomada.
  \item Distancia recorrida por la estrella secundaria.
  \item Separación entre las estrellas en la primera foto tomada.
  \item Distancia recorrida por la estrella primaria.
  \item Ángulo de la trayectoria de la estrella secundaria.
  \item Ángulo de la trayectoria de la estrella primaria.
  \item Ángulo de la posición de la estrella secundaria con respecto a la
  primaria en la primera foto.
  \item Ángulo de la posición de la estrella secundaria con respecto a la
  primaria en la segunda foto.
\end{enumerate}

\medskip

Una vez obtenidos los datos de la figura \ref{cap4:fig:6} se procede a
procesarlos para calcular los valores que se utilizan para clasificar estrellas
dobles.

%-------------------------------------------------------------------
\section{Decisión}
%-------------------------------------------------------------------
\label{cap4:sec:decision}

Una vez obtenidos los valores de la sección \ref{cap4:sec:analisis} se procede
al estudio de los mismos, para decidir si la pareja de estrellas es binaria o
no. Previamente al diseño de nuestro algoritmo, se estudió qué similitudes hay
entre las parejas de estrellas binarias ya catalogadas. Se llegó a la conclusión
que estas mantienen entre sí su posición relativa a lo largo de los años.Es
decir, la separación entre ellas, el ángulo de la una con la otra, el ángulo de
su trayectoria debería ser aproximadamente iguales. Además, la relación entre el
área de cada una de las estrellas debe mantenerse a lo largo del tiempo.

\medskip

Una vez decididos valores necesarios para tomar la decisión Procedimos a
establecer unos valores críticos que marcaran el límite entre lo que podría
considerarse estrella doble y lo que no. En caso de que la diferencia entre los
valores antes y después, por ejemplo la distancia entre las estrellas, fuera
superior al valor crítico decidido para la distancia, la estrella
automáticamente sería descartada. En caso contrario se pasaría a comprobar el
siguiente valor. Estas comprobaciones actuarían como un filtro por etapas, de
manera que si la pareja de estrellas supera todas las etapas, sería considerada
estrella doble.

\medskip

Estos valores críticos son:

\begin{itemize}
  \item El error entre los ángulos que forman ambas estrellas puede ser como
    máximo 5.
  \item El error entre los ángulos del vector velocidad es como máximo 15.
  \item La diferencia entre sus desplazamientos o separaciones no puede
    sobrepasar el 7\%.
  \item La proporción entre el area de la componente principal y la secundaria
    del sistema es, a lo sumo, 2.
  \item La proporción entre las distancias recorridas no puede ser superior a
    .1.3
  \item Una estrella no puede haber realizado un desplazamiento superior a 80.
  \item La separación de cualquier componente del sistema no puede ser superior
    a 200.
  \item Debido que los sitemas binarios no son comunes y puesto que los cúmulos
    de estrellas generan problemas, no puede existir más de una estrella doble.
  \item Si la fotografía tiene más de 60 estrellas o bien se trata de un cúmulo
    o bien de un fallo de superposición por lo que no es válida.
  \item El movimiento propio de ambas componentes ha de ser inferior a 2500,
    es tan inusual encontrar valores mayores que casi con total seguridad se
    trataria de un error.
\end{itemize}

\medskip

Además, con el fin de normalizar los datos al formato de WDS, se calcularon los
factores de conversion que hay que aplicar a nuestros cálculos:

\begin{itemize}
  \item El movimiento propio se ha de multiplicar por 6.8.
  \item La separación se multiplica por 1/3.95.
\end{itemize}

\medskip

Además de los filtros anteriormente descritos, se añadió un filtro más de manera
que si la fotografía contuviese más de una pareja de estrellas, lo cual es
bastante difícil que se de, se descarta porque probablemente se deba a que el
montaje de las dos fotografías está mal hecho, por los motivos mencionados en la
sección \ref{cap2:sec:aladin}, y parece que todas las estrellas se desplazan en
la misma dirección o porque la fotografía representa un cúmulo de estrellas en
los cuales nuestra aplicación no podría detectar nada.

\medskip

Una vez que la estrella ha pasado todos los filtros, se procede a pintar sus
centros de otro color en la imagen recoloreada y se guardan los valores de sus
atributos obtenidos de su análisis, de manera que sea fácil su comprobación.
