%---------------------------------------------------------------------
%
%                          Capítulo 4
%
%---------------------------------------------------------------------
% !TEX root = ../Tesis.tex

\chapter{Detector}
\label{cap4}

\begin{resumen}
La detección es el paso que sigue al recoloreado y está dividida en dos partes.
La primera parte de la detección se basa en el análisis  de la imagen obtenida
en el recoloreado. Este análisis se lleva a cabo separando la imagen en dos que
representan los cambios a lo largo del tiempo y calculando las diferencias entre
cada posible pareja de estrellas. Con los resultados de este análisis se procede
a la fase de decisión la cual se encarga de procesar los resultados de la etapa
posterior y decidir, para cada pareja de estrellas, si forman o no una estrella
doble. Esto se realizará mediante un árbol de decisión.
\end{resumen}

%-------------------------------------------------------------------
\section{Análisis}
%-------------------------------------------------------------------
\label{cap4:sec:analisis}

Hemos programado esta fase en el lenguaje Python, debido a la gran cantidad de
bibliotecas que permiten tratar imágenes.

\medskip

En particular, para la detección de estrellas dobles se decidió utilizar la
biblioteca de tratamiento de imágenes OpenCV. El desarrollo de esta fase se
realizó en varias etapas.

\medskip

Después de analizar cientos de imágenes de estrellas dobles, se decidió recrear
el mismo procedimiento que se realiza mentalmente a la hora de decidir si son
dobles o no. Para decidirlo hay que fijarse en que sus trayectorias sean
paralelas y la distancia recorrida sea aproximadamente la misma.

\medskip

Para llevar a cabo este procedimiento necesitamos encontrar un centro aproximado
de cada una de las estrellas del recoloreado para poder así buscar relaciones,
de distancia y ángulo, entre parejas de estrellas cuyo movimiento haya sido
similar a lo largo de los años.

\medskip

Una primera aproximación se basó en la búsqueda de los contornos de las diversas
estrellas en función de sus colores y el uso de estos contornos para obtener el
centro de la estrella. Esta aproximación permitió relacionar aquellas estrellas
cuyo movimiento hubiese sido lo suficientemente rápido como para que no
compartan ningún punto entre la primera foto y la segunda.

\figura{Vectorial/Detector/1}{width=.5\textwidth}{cap4:fig:1}%
{Estrella binaria con movimiento veloz}

\medskip

El movimiento de la estrella de la figura \ref{cap4:fig:1} es suficientemente
rápido como para que entre la primera foto y la segunda no exista ningún punto
en común por lo que la obtención del centro para su posterior análisis no
requiere de ningún cambio en la foto. El problema de este método radica en que
si la estrella no se ha movido lo suficientemente rápido, existirán puntos
comunes, representados en color blanco. Debido a esto, se obtendrían tres
centros distintos para una misma pareja de  estrellas y ninguno de ellos serían
los centros reales de las dos estrellas.

\medskip

El problema de este método radica en que si la estrella no se ha movido lo
suficientemente rápido. Se obtendrían tres centros distintos para una misma
pareja de estrellas y ninguno de ellos serían los centros reales de las dos
estrellas.

\figura{Vectorial/Detector/2}{width=.5\textwidth}{cap4:fig:2}%
{Estrella binaria cuyo movimiento no es tan apreciable debido a su menor velocidad}

\medskip

Para subsanar el error se decidió realizar el análisis de contornos por
separado. Para ello se filtran la imagen en dos imágenes de manera que una tiene
el color rojo y el blanco, y la otra el azul y el blanco. De esta manera se
obtienen los centros y áreas de las estrellas en origen y los centros de las
estrellas en el destino y se pueden relacionar de manera directa.

\figura{Vectorial/Detector/3}{width=.5\textwidth}{cap4:fig:3}%
{Estrella binaria con bajo movimiento propio}

\begin{figure}[t]
  \centering
  %
  \subfloat[][]{
    \includegraphics[width=0.42\textwidth]%
    {Imagenes/Vectorial/Detector/4}
    \label{cap4:fig:red}
  }
  \qquad
  \subfloat[][]{
    \includegraphics[width=0.42\textwidth]%
    {Imagenes/Vectorial/Detector/5}
    \label{cap4:fig:blue}
  }
  \caption{A partir de la imagen recoloreada, figura \ref{cap4:fig:3}, se obtienen dos imágenes}
\end{figure}

\medskip

Una vez obtenidos los centros y áreas de todas las estrellas se procede a
especificar cuál sería la estrella primaria, la de mayor área, y cuál sería la
estrella secundaria, de menor área. Y calculamos los valores necesarios para su
clasificación, figura \ref{cap4:fig:6}.

\figura{Vectorial/Detector/6}{width=.5\textwidth}{cap4:fig:6}%
{Representación de valores calculados}

\medskip

Los valores representados en la figura \ref{cap4:fig:6} corresponden a:

\begin{enumerate}[label=(\alph*)]
  \item Separación entre las estrellas en la segunda foto tomada.
  \item Distancia recorrida por la estrella secundaria.
  \item Separación entre las estrellas en la primera foto tomada.
  \item Distancia recorrida por la estrella primaria.
  \item Ángulo de la trayectoria de la estrella secundaria.
  \item Ángulo de la trayectoria de la estrella primaria.
  \item Ángulo de la posición de la estrella secundaria con respecto a la
  primaria en la primera foto.
  \item Ángulo de la posición de la estrella secundaria con respecto a la
  primaria en la segunda foto.
\end{enumerate}

\medskip

Una vez obtenidos los datos de la figura \ref{cap4:fig:6} se procede a
procesarlos para calcular los valores que se utilizan para clasificar estrellas
dobles. Por último, un árbol de decisión se encargará de procesar estos datos y
clasificar la pareja de estrellas.

%-------------------------------------------------------------------
\section{Parametrización}
%-------------------------------------------------------------------
\label{cap4:sec:params}

El siguiente paso consistía en procesar todos los datos calculados en la fase de
análisis con la ayuda de un modelo de Machine Learning para encontrar el ajuste
de los valores que hacen únicas a las estrellas dobles frente al resto de
estrellas.

\medskip

La existencia de este paso se debe a que en primera instancia realizábamos a
mano el ajuste de valores para decidir cuándo dos estrellas formaban parte de un
sistema binario y cuándo no.

\medskip

Debido a que este proceso era muy largo y tedioso, se nos ocurrió que podíamos
implementar un programa que encontrara por nosotros cuáles eran esos valores que
mejor ajustaran la clasificación de las estrellas dobles.

\medskip

Por todo ello decidimos realizar un modelo de Machine Learning en Python con la
ayuda de la biblioteca de Scikit-learn, dado que es la mejor para realizar este
tipo de tareas. (Insertar aquí el bibtex de sklearn).

\medskip

En esta fase, nuestro trabajo consistió en realizar un proceso similar al de
detección, pero con la particularidad de que los datos calculados para cada
estrella en la imagen pasarían a ser introducidos en un modelo de Machine
Learning basado en árboles de decisión conocido como ?Random Forest?, del mismo
modo incluimos una clase que representa  si la estrella analizada formaba parte
o no de un sistema binario, de tal manera que pudiéramos aprovechar el árbol
resultante para introducir en la fase de detección los valores concretos en la
comprobación de si una estrella cumple con lo especificado en un sistema
binario.

\medskip

Para realizar este trabajo, el modelo propuesto debería analizar un conjunto de
imágenes en las que hubiera en cada una de ellas estrellas dobles. Además
deberíamos identificar a las dos estrellas que formaban parte del sistema
binario.

\medskip

Para conseguir esto descubrimos que si utilizábamos los atributos del ángulo de
posición y la separación, teniendo en cuenta un margen de error, los podríamos
comparar con los que nos proporciona el catálogo de WDS para la coordenada en la
que está situada el sistema binario, y añadir así, la clase de estrella doble a
las estrellas de la imagen que cumplan esa condición, que no deberían ser más
que dos.

\medskip

Durante la implementación de esta fase investigamos acerca de cómo obtener un
árbol de decisión a partir del modelo generado, que nos permitiera obtener un
criterio a la hora de discernir sobre si dos estrellas pertenecen o no a un
sistema binario.

\medskip

En este momento nos dimos cuenta que, aunque los modelos basados en árboles de
decisión, como Random Forest en nuestro caso, permiten obtener dicho árbol, este
no nos proporcionaba la información que buscábamos, en cambio, nos facilitaba un
árbol por cada estimador del modelo que en cada nodo indicaba si las muestras
pasaban por él o no.

\medskip

Debido a este contratiempo en el último momento del desarrollo, que no pudimos
subsanar, decidimos simplemente descartar esta fase de parametrización y
trabajar con el ajuste que se realizó a mano en las primeras instancias de la
detección.
