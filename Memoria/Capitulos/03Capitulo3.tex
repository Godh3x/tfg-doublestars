%---------------------------------------------------------------------
%
%                          Capítulo 2
%
%---------------------------------------------------------------------
% !TEX root = ../Tesis.tex

\chapter{Procesamiento}

%-------------------------------------------------------------------
\section{Recoloreado}
%-------------------------------------------------------------------
\label{cap3:sec:recolor}

A simple vista las imagenes obtenidas en la sección \ref{cap2:sec:imgdownload}
están coloreadas y nos permiten apreciar las diferencias fácilmente. El problema
surge cuando queremos que el programa haga las misma extrapolaciones que hace
nuestro cerebro.

\medskip

Con el fin de facilitar la comparación de los pixels la imagen pasa por un
proceso de recoloreado que transforma la imagen pixel a pixel.

\medskip

Los colores que reconoce este proceso se definen mediante un diccionario que
almacena el nombre y composición del mismo. Esto facilita la modificación de los
grupos reconocidos de modo que un cambio en el coloreado inicial de las imagenes
no supone un problema.

\medskip

El problema de este proceso es definir cómo ha de interpretar la tonalidad del
pixel, para atajarlo hemos empleado la distancia Manhanttan. Se trata de
medir la distancia entre la composición del pixel y la del grupo, asumiendo
que ambas tonalidades son RGB y que están almacenadas en triplas, de la forma
(R, G, B), tan solo hemos de restar cada componente con su homóloga y sumar los
resultados para obtener un valor. El grupo que resulte con menor valor será
aquel al que pertenezca el pixel.

\begin{figure}[t]
  \centering
  %
  \subfloat[][]{
    \includegraphics[width=0.42\textwidth]%
    {Imagenes/Vectorial/03Cap3/no_recolor}
    \label{cap3:fig:norec}
  }
  \qquad
  \subfloat[][]{
    \includegraphics[width=0.42\textwidth]%
    {Imagenes/Vectorial/03Cap3/recolor}
    \label{cap3:fig:rec}
  }
  \caption{Recoloreado usando la distancia Manhattan\label{cap3:fig:dManh}}
\end{figure}

\medskip

Tal y como muestra la imágen \ref{cap3:fig:rec} hay información que se pierde
durante el proceso debido a que las estrellas están muy apagadas haciendo que
la distancia al negro sea menor que al azul o rojo. Para poder atajar este
problema se realiza una comprobación posterior, si el grupo asignado es negro
pero la distancia al azul o al rojo es inferior a un cierto umbral se reasigna
el grupo del pixel, imagen

\figura{Vectorial/03Cap3/recolor_thresh}{width=.5\textwidth}{cap3:fig:rthresh}%
{Recoloreado de la imagen \ref{cap3:fig:norec} con un umbral de 150}

\medskip

Cuando se ha obtenido el grupo del pixel se pinta del color de grupo en un
canvas, una vez se han procesado todos los pixel se almacena el resultado en un
fichero png.

%-------------------------------------------------------------------
\section{Comprobación}
%-------------------------------------------------------------------
\label{cap3:sec:check}

Aún cuando el detector acepta un sistema de estrellas dobles existe un problema,
puede no tratarse de un sistema nuevo. Para solventar esto existe una
fase de comprobación que se puede activar para todos los sistemas aceptados.

\medskip

Si se ha solicitado esta fase se realiza un primer paso que consiste en
conectarse a WDS y descargar los datos de los sistemas conocidos, este paso solo
se hace una vez por ejecución, al comienzo, para no saturar los servidores. El
hecho de emplear los mismos datos durante una ejecución completa no supone un
problema puesto que la base de datos no se altera habitualmente.

\medskip

Cuando un sistema es aceptado esta fase toma sus coordenadas y busca
coincidencias en todas las entradas descargadas, si no hay ninguna se ignora el
sistema detectado. Si por el contrario existen datos asociados al sistema se
almacenan en un archivo json junto con los datos proporcionados por el detector
y el calculo del error entre ambos.

\medskip

Si bien esta fase es una primera comprobación sus resultados no son definitivos,
en el caso del no, puesto que se comprueban las coordenadas centrales de la
imagen. Si la estrella no se encuentra en el centro es imposible para este
programa determinar si el sistema ya se conocía o no.

%-------------------------------------------------------------------
\section*{\NotasBibliograficas}
%-------------------------------------------------------------------
\TocNotasBibliograficas

...